<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SportsBridge â€¢ Set Password</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
<div class="container" style="max-width:480px;">
  <div class="card shadow-sm mt-5">
    <div class="card-body">
      <h4 class="mb-3">Set Your Password</h4>
      <div id="alert" class="alert d-none" role="alert"></div>
      <div class="mb-3">
        <label class="form-label">New Password</label>
        <input id="p1" type="password" class="form-control" />
      </div>
      <div class="mb-3">
        <label class="form-label">Confirm Password</label>
        <input id="p2" type="password" class="form-control" />
      </div>
      <div class="d-grid gap-2">
        <button id="saveBtn" class="btn btn-primary">Save Password</button>
        <a href="/password-login.html" class="btn btn-outline-secondary">Login with Password</a>
      </div>
      <div class="mt-3 text-muted small">Note: You must have just completed OTP verification so a token is present. If not, please <a href="/otp-login.html">login via OTP</a> first.</div>
    </div>
  </div>
</div>
<script>
(function(){
  const alertBox = document.getElementById('alert');
  function show(msg, type){ alertBox.className = 'alert alert-' + (type||'info'); alertBox.textContent = msg; alertBox.classList.remove('d-none'); }
  async function call(url, method, body){
    const token = localStorage.getItem('sb_token');
    const res = await fetch(url, { method, headers: { 'Content-Type':'application/json', 'Authorization': 'Bearer ' + token }, body: JSON.stringify(body)});
    const j = await res.json().catch(()=>({}));
    if (!res.ok) throw new Error(j.error || res.statusText);
    return j;
  }
  document.getElementById('saveBtn').onclick = async()=>{
    const p1 = document.getElementById('p1').value;
    const p2 = document.getElementById('p2').value;
    if (p1.length < 6) { show('Password must be at least 6 characters', 'danger'); return; }
    if (p1 !== p2) { show('Passwords do not match', 'danger'); return; }
    try{
      show('Saving...', 'info');
      await call('/api/auth/set-password', 'POST', { password: p1 });
      show('Password set successfully! You can now login with password.', 'success');
      setTimeout(()=> location.href = '/password-login.html', 800);
    }catch(e){ show(e.message, 'danger'); }
  };
})();
</script>
</body>
</html>

